<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TabiMate è¡Œç¨‹è¦åŠƒ</title>
    <!-- è¼‰å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* ä½¿ç”¨ Inter å­—é«”ä¸¦ç¢ºä¿ä¸­æ–‡å­—é«”å¯è®€æ€§ */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&family=Noto+Sans+TC:wght@100..900&display=swap');
        body {
            font-family: 'Inter', 'Noto Sans TC', sans-serif;
            background-color: #f0f4f8; /* æŸ”å’ŒèƒŒæ™¯è‰² */
        }
        /* æ¨¡æ“¬æ‰‹æ©Ÿå¤–æ®¼å’Œå…¨å±è¦–åœ– */
        .mobile-app-container {
            width: 100%;
            max-width: 420px; /* æ¨™æº–æ‰‹æ©Ÿå¯¬åº¦ */
            height: 100vh;
            margin: 0 auto;
            background-color: white;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            border-radius: 0.75rem; /* æ¨¡æ“¬åœ“è§’ App é‚Šæ¡† */
        }
        /* ä¸»è¦ App ä¸»é¡Œè‰² (ç´…è‰²/æ©˜è‰²ç³») */
        .app-primary { background-color: #FF5A5F; }
        .app-primary-text { color: #FF5A5F; }
        .app-primary-light { background-color: #FEE2E2; }
        
        /* ç¢ºä¿åœ°åœ–å¡«æ»¿ç©ºé–“ */
        #map {
            height: 100%;
            width: 100%;
        }
    </style>
</head>
<body>

    <!-- æ‡‰ç”¨ç¨‹å¼å®¹å™¨ - æ¨¡æ“¬æ‰‹æ©Ÿä»‹é¢ -->
    <div id="app" class="mobile-app-container">

        <!-- é ‚éƒ¨ Header/å°èˆªæ¬„ -->
        <header class="app-primary p-4 shadow-lg text-white flex justify-between items-center flex-shrink-0">
            <button id="back-button" class="hidden p-1 rounded-full hover:bg-white/20 transition-opacity" onclick="showTripList()">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg>
            </button>
            <h1 id="header-title" class="text-xl font-semibold w-full text-center">æˆ‘çš„æ—…éŠè¡Œç¨‹</h1>
            <button id="add-trip-button" class="p-1 rounded-full hover:bg-white/20 transition-opacity" onclick="alertMessage('æ–°å¢è¡Œç¨‹åŠŸèƒ½è¢«è§¸ç™¼')">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
            </button>
        </header>

        <!-- ä¸»è¦å…§å®¹å€ (å¯æ»¾å‹•) -->
        <main id="content-area" class="flex-grow overflow-y-auto">
            
            <!-- 1. è¡Œç¨‹åˆ—è¡¨ç•«é¢ (é è¨­é¡¯ç¤º) -->
            <div id="trip-list-view" class="p-4 space-y-4">
                <!-- è¡Œç¨‹å¡ç‰‡å°‡ç”± JS æ¸²æŸ“ -->
                <div id="trip-cards-container" class="space-y-4">
                    <!-- ç¯„ä¾‹è¡Œç¨‹ -->
                </div>
            </div>

            <!-- 2. åœ°åœ–/å°èˆªç•«é¢ -->
            <div id="map-view" class="h-full w-full hidden flex flex-col">
                <div id="map-info" class="p-4 bg-white shadow-md flex-shrink-0">
                    <p class="font-bold text-lg app-primary-text">å°èˆªè·¯ç·šï¼š<span id="map-destination-name">ç›®çš„åœ°</span></p>
                    <p class="text-sm text-gray-500">è¦åŠƒä¸­...</p>
                </div>
                <div id="map" class="flex-grow">
                    <!-- Google Maps å°‡åœ¨æ­¤è™•åˆå§‹åŒ– -->
                </div>
            </div>

        </main>
        
        <!-- åº•éƒ¨æ¶ˆæ¯/æç¤ºæ¡† (æ¨¡æ“¬ Alert) -->
        <div id="message-box" class="fixed bottom-0 left-0 right-0 p-4 hidden z-20 transition-all duration-300 transform translate-y-full max-w-[420px] mx-auto" style="bottom: 0;">
            <!-- è¨Šæ¯å…§å®¹ -->
        </div>

    </div>

    <!-- Google Maps API è¼‰å…¥é» -->
    <!-- è«‹å‹™å¿…æ›¿æ› YOUR_GOOGLE_MAPS_API_KEY ç‚ºæ‚¨è‡ªå·±çš„é‡‘é‘° -->
    <script async defer
        src="https://maps.googleapis.com/maps/api/js?key=YOUR_GOOGLE_MAPS_API_KEY&libraries=places,geometry&callback=initApp">
    </script>

    <script>
        // --- å…¨åŸŸè®Šæ•¸å’Œç‹€æ…‹ ---
        let map;
        let directionsService;
        let directionsRenderer;
        let currentTrip = null; // ç•¶å‰é¸æ“‡çš„è¡Œç¨‹æ•¸æ“š
        const mapDiv = document.getElementById('map');
        const contentArea = document.getElementById('content-area');
        
        // æ¨¡æ“¬è¡Œç¨‹æ•¸æ“šï¼ˆé€šå¸¸å¾ Firestore æˆ– API è¼‰å…¥ï¼‰
        const trips = [
            { id: 1, title: 'æ—¥æœ¬é—œè¥¿ç¾é£Ÿä¹‹æ—…', date: '2026/03/01 - 03/07', days: 7, 
              items: [
                { name: 'å¤§é˜ªåŸ', lat: 34.6873, lng: 135.5262, time: '10:00', icon: 'ğŸ¯' },
                { name: 'é“é “å € (æ™šé¤)', lat: 34.6687, lng: 135.5020, time: '18:30', icon: 'ğŸ¦€' }
              ] 
            },
            { id: 2, title: 'æ±äº¬è³¼ç‰©èˆ‡æ–‡åŒ–é«”é©—', date: '2026/06/15 - 06/20', days: 6, 
              items: [
                { name: 'æ·ºè‰å¯º', lat: 35.7147, lng: 139.7967, time: '09:00', icon: 'â›©ï¸' },
                { name: 'æ¾€è°·äº¤å‰å£', lat: 35.6591, lng: 139.7011, time: '14:00', icon: 'ğŸš¥' }
              ] 
            }
        ];

        // --- æ ¸å¿ƒå·¥å…·å‡½æ•¸ ---

        // æ¨¡æ“¬ App çš„ Alert æç¤ºï¼Œé¿å…ä½¿ç”¨ window.alert
        function alertMessage(message, duration = 3000) {
            const msgBox = document.getElementById('message-box');
            msgBox.classList.remove('hidden', 'translate-y-full');
            msgBox.classList.add('flex', 'justify-center', 'items-center');
            msgBox.innerHTML = `
                <div class="bg-gray-800 text-white px-6 py-3 rounded-xl shadow-2xl flex items-center space-x-2">
                    <svg class="w-5 h-5 text-yellow-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                    <span>${message}</span>
                </div>
            `;
            setTimeout(() => {
                msgBox.classList.add('translate-y-full');
                setTimeout(() => msgBox.classList.add('hidden'), 300); // å»¶é²éš±è—
            }, duration);
        }

        // --- Google Maps ç›¸é—œå‡½æ•¸ ---

        // Google Maps API è¼‰å…¥å¾Œçš„åˆå§‹åŒ–å›èª¿å‡½æ•¸
        window.initApp = function() {
            // åˆå§‹åŒ–åœ°åœ–æœå‹™ï¼Œä½†å…ˆä¸é¡¯ç¤ºåœ°åœ–
            directionsService = new google.maps.DirectionsService();
            directionsRenderer = new google.maps.DirectionsRenderer();
            
            // æ¸²æŸ“åˆå§‹ç•«é¢ (è¡Œç¨‹åˆ—è¡¨)
            renderTripCards();
        }

        // åˆå§‹åŒ–/é¡¯ç¤ºåœ°åœ–
        function initMap(centerLat, centerLng) {
            // å¦‚æœåœ°åœ–å·²ç¶“å­˜åœ¨ï¼Œå‰‡ç›´æ¥ä½¿ç”¨
            if (map) {
                map.setCenter({ lat: centerLat, lng: centerLng });
                directionsRenderer.setMap(null); // æ¸…é™¤èˆŠè·¯ç·š
                directionsRenderer.setMap(map);  // é‡æ–°ç¶å®š
                return;
            }

            // é¦–æ¬¡åˆå§‹åŒ–åœ°åœ–
            map = new google.maps.Map(mapDiv, {
                center: { lat: centerLat, lng: centerLng },
                zoom: 12,
                mapTypeControl: false,
                streetViewControl: false,
                fullscreenControl: false,
                zoomControl: true,
            });
            directionsRenderer.setMap(map);
            alertMessage('åœ°åœ–æœå‹™è¼‰å…¥æˆåŠŸï¼', 2000);
        }

        // è¦åŠƒå°èˆªè·¯ç·š
        function plotDirections(origin, destination, destinationName) {
            initMap(destination.lat, destination.lng); // ç¢ºä¿åœ°åœ–å·²åˆå§‹åŒ–ä¸¦ä»¥ç›®çš„åœ°ç‚ºä¸­å¿ƒ
            
            // ç”±æ–¼æˆ‘å€‘æ²’æœ‰èµ·é»ï¼Œæˆ‘å€‘ä½¿ç”¨ä¸€å€‹å›ºå®š/æ¨¡æ“¬çš„èµ·é»ä¾†å±•ç¤ºè·¯ç·šåŠŸèƒ½
            const mockOrigin = { lat: destination.lat + 0.05, lng: destination.lng - 0.05 }; 

            document.getElementById('map-destination-name').textContent = destinationName;
            document.getElementById('map-info').querySelector('p:last-child').textContent = 'è¦åŠƒè·¯ç·šä¸­...';

            directionsService.route(
                {
                    origin: mockOrigin,
                    destination: destination,
                    travelMode: google.maps.TravelMode.DRIVING, // é¸æ“‡é§•é§›æ¨¡å¼
                },
                (response, status) => {
                    if (status === 'OK') {
                        directionsRenderer.setDirections(response);
                        const route = response.routes[0].legs[0];
                        document.getElementById('map-info').querySelector('p:last-child').innerHTML = 
                            `è·é›¢: ${route.distance.text} | é è¨ˆæ™‚é–“: ${route.duration.text}`;
                    } else {
                        directionsRenderer.setDirections({ routes: [] }); // æ¸…é™¤è·¯ç·š
                        alertMessage('ç„¡æ³•è¼‰å…¥å°èˆªè·¯ç·š: ' + status, 5000);
                        document.getElementById('map-info').querySelector('p:last-child').textContent = 'ç„¡æ³•è¦åŠƒè·¯ç·š';
                    }
                }
            );
        }

        // --- UI/ç•«é¢æ§åˆ¶å‡½æ•¸ ---

        // é¡¯ç¤ºè¡Œç¨‹åˆ—è¡¨ç•«é¢
        function showTripList() {
            document.getElementById('map-view').classList.add('hidden');
            document.getElementById('trip-list-view').classList.remove('hidden');
            
            document.getElementById('back-button').classList.add('hidden');
            document.getElementById('add-trip-button').classList.remove('hidden');
            document.getElementById('header-title').textContent = 'æˆ‘çš„æ—…éŠè¡Œç¨‹';
        }

        // é¡¯ç¤ºåœ°åœ–ç•«é¢
        function showMap(destination, name) {
            document.getElementById('trip-list-view').classList.add('hidden');
            document.getElementById('map-view').classList.remove('hidden');

            document.getElementById('back-button').classList.remove('hidden');
            document.getElementById('add-trip-button').classList.add('hidden');
            document.getElementById('header-title').textContent = 'å°èˆªä¸­';

            plotDirections(null, destination, name); // è¦åŠƒè·¯ç·š
        }

        // æ¸²æŸ“è¡Œç¨‹åˆ—è¡¨å¡ç‰‡
        function renderTripCards() {
            const container = document.getElementById('trip-cards-container');
            container.innerHTML = trips.map(trip => `
                <div class="bg-white p-4 rounded-xl shadow-lg border-l-4 border-red-500 hover:shadow-xl transition duration-200">
                    <h3 class="font-bold text-lg app-primary-text">${trip.title}</h3>
                    <p class="text-sm text-gray-500 mt-1">${trip.date} (${trip.days}å¤©)</p>
                    <div class="mt-3 space-y-2">
                        <!-- è¡Œç¨‹é …ç›®åˆ—è¡¨ -->
                        ${trip.items.map(item => `
                            <div class="flex justify-between items-center text-sm p-2 app-primary-light rounded-lg">
                                <div class="flex items-center space-x-2">
                                    <span class="text-lg">${item.icon}</span>
                                    <span>${item.name} (${item.time})</span>
                                </div>
                                <button onclick="showMap({lat: ${item.lat}, lng: ${item.lng}}, '${item.name}')" 
                                        class="text-white text-xs bg-red-500 py-1 px-3 rounded-full hover:bg-red-600 transition">
                                    å°èˆª
                                </button>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `).join('');
        }
        
        // åˆå§‹è¼‰å…¥æ™‚ï¼Œç¢ºä¿ App é¡¯ç¤ºè¡Œç¨‹åˆ—è¡¨
        document.addEventListener('DOMContentLoaded', () => {
            // å¦‚æœ Google Maps API è…³æœ¬è¼‰å…¥è¼ƒå¿«ï¼ŒinitApp æœƒå…ˆåŸ·è¡Œã€‚
            // é€™è£¡ä½œç‚ºå‚™ç”¨ï¼Œç¢ºä¿åœ¨ DOMContentLoaded äº‹ä»¶å¾ŒåŸ·è¡Œã€‚
            if (typeof google === 'undefined' || !google.maps.Map) {
                // å¦‚æœ Google Maps å°šæœªè¼‰å…¥ï¼Œç­‰å¾… initApp å›èª¿
            } else {
                 initApp();
            }
        });

    </script>
Fix: Replace Dart code with actual index.html

